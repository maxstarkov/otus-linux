## Решение задания

Для проверки задания нужно запустить ВМ:

```
vagrant up
```

При запуске ВМ будут созданы два пользователя johndoe и janedoe, а также группа admin.
Пользователь johndoe будет добавлен в группу admin.
Пользователям будут назначены пароли Otus2020 и разрешена аутентификация по паролю для ssh.

Чтобы ограничить доступ всем пользователям в выходные дни, кроме пользователей группы admin, можно использовать PAM модуль `pam_exec`.
Подключение модуля выполняется через добавление в файл `/etc/pam.d/sshd` строки:

```
...
account    required     pam_exec.so /usr/local/bin/admin_group_login.sh
...
```

Этот модуль будет вызывать скрипт [admin_group_login.sh](./admin_group_login.sh).
В скрипте выполняется проверка на принадлежность пользователя группе admin (или группе vagrant):

```
...
if groups $PAM_USER | grep -Pq "(\badmin\b|\bvagrant\b)"; then
...
```

, выполняется проверка дня недели:

```
...
if (( $day_of_week > 5 )); then
...
```

Если пользователь не входит в группу admin и текущий день недели приходится на выходные (без учета праздничных дней), тогда скрипт завершается с кодом возврата 1 и происходит отказ авторизации пользователя.

### Дополнительные вопросы

Чтобы разрешить конкретному пользователю работу с docker, его нужно добавить в группу docker.
Например для пользователя vagrant нужно выполнить команду:

```
usermod -aG docker vagrant
```

Есть и другие способы обеспечения работы с docker, но по сути они предполагают разрешение на доступ к сокету `/var/run/docker.sock`.
Доступ к нему можно разрешить через ACL, например для пользователя janedoe:

```
[root@localhost ~]# setfacl -m user:janedoe:rw /var/run/docker.sock
```

В результате будут установлены такие права:

```
[root@localhost ~]# getfacl /var/run/docker.sock
getfacl: Removing leading '/' from absolute path names
# file: var/run/docker.sock
# owner: root
# group: docker
user::rw-
user:janedoe:rw-
group::rw-
mask::rw-
other::---
```

Пользователь действительно сможет полноценно работать с docker, однако он также сможет получить полный доступ к системе, запустив контейнер следующим образом:

```
[janedoe@localhost ~]$ docker run -it --privileged -v /:/host centos chroot /host
```

При запуске такого контейнера в каталог host на контейнере будет примонтирован корень хоста и в него сделан chroot.
Это даст пользователю неограниченные права на хосте docker.

Поэтому самое простое и явное решение задачи - включить пользователя в группу docker.

Для того, чтобы дать конкретному пользователю права на перезапуск службы docker, можно добавить файл в каталог `/etc/sudoers.d`, где указать необходимые разрешения:

```
echo "johndoe ALL= NOPASSWD: /bin/systemctl restart docker" > /etc/sudoers.d/johndoe
```

Данная команда разрешит пользователю johndoe перезапускать службу docker командой:

```
[johndoe@localhost ~]$ sudo systemctl restart docker
```